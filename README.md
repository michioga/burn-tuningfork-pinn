# 音叉設計PINN (Tuning Fork Design PINN)

このプロジェクトは、[Burn](https://burn.dev/)フレームワークを使用して構築された、**物理法則情報付きニューラルネットワーク（PINN）** の実装です。目標とする周波数（Hz）を入力すると、その周波数を実現するための音叉の最適な寸法を予測する**逆設計問題**を解決します。

一連のデバッグとチューニングを経て、現在は安定した学習が可能な状態です。モデルの精度は現在、学習データセットのサイズに依存しており、本プロジェクトは今後のデータ拡張による性能向上のための強固なベースラインとして機能します。

## 特徴

  - **逆問題解決**: 通常のシミュレーション（寸法→周波数）とは逆に、目標の周波数から最適な寸法を予測します。
  - **ハイブリッド学習**: 高精度なFEMシミュレーションデータ（正解データ）と、物理法則（ティモシェンコ梁理論）に基づく損失を組み合わせることで、データへの忠実度と物理的な妥当性のバランスを取ります。
  - **高度なMLPモデル**: 過学習を防ぐ**Dropout**と学習を安定させる**LayerNorm**を備えた4層の多層パーセプトロン（MLP）を採用しています。
  - **安定した学習プロセス**: **勾配クリッピング**を導入することで、複雑な損失地形でも安定した学習を実現します。
  - **インタラクティブな学習UI**: `burn-train`に組み込まれたCUIダッシュボードにより、学習の進捗をリアルタイムで確認できます。

-----

## PINNの学習プロセス

このモデルは、「FEMシミュレーションデータ」と「物理法則の近似式」という2つの情報源を組み合わせて学習します。そのバランスは`ALPHA`という定数によって制御されます。

$$\mathcal{L}_{total} = \alpha \cdot \mathcal{L}_{data} + (1 - \alpha) \cdot \mathcal{L}_{physics}$$

  - **データ損失 ($\mathcal{L}_{data}$)**: FEMデータ（`summary_parameters.csv`）を絶対的な「正解」と見なします。モデルの予測した寸法と、FEMデータ内の正解寸法との平均二乗誤差（MSE）を計算します。
  - **物理損失 ($\mathcal{L}_{physics}$)**: **物理法則の近似式**を「ヒント」として利用します。
    1.  モデルが予測した寸法から、梁理論に基づき周波数を計算します。
    2.  計算された周波数と目標周波数との誤差（`frequency_loss`）を求めます。
    3.  予測された寸法が物理的に妥当な範囲（例: プロングは長すぎない、細すぎない）に収まっているかの**ペナルティ**も加算します。

`ALPHA`の値を調整することで、FEMデータにどれだけ忠実であるべきか、物理法則のヒントをどれだけ重視すべきかのバランスを調整できます。

-----

## プロジェクト構造

```
.
├── Cargo.toml
├── data/
│   └── summary_parameters.csv  # 学習用のFEMデータセット
├── artifacts/                  # 学習済みモデルやログが保存される
├── src/
│   ├── main.rs                 # エントリポイント、CLIの定義
│   ├── constants.rs            # 物理定数、損失の重み、モデルの次元定義
│   ├── dataset.rs              # CSVデータセットの読み込みとバッチ処理
│   ├── model.rs                # 4層MLPモデル（Dropout含む）の定義
│   ├── physics.rs              # 物理法則に基づいた損失関数の定義
│   ├── train.rs                # モデルの学習処理（LearnerBuilder使用）
│   └── infer.rs                # 学習済みモデルを使った推論処理
└── README.md                   # このファイル
```

-----

## セットアップ

1.  **Rust Toolchain**: [公式サイト](https://www.rust-lang.org/tools/install)の手順に従って、最新のRustをインストールします。
2.  **依存関係のインストール**:
    ```bash
    cargo build --release
    ```

-----

## 使い方

### 学習

以下のコマンドでモデルの学習を開始します。`--backend`フラグで計算バックエンド（`wgpu`, `cuda`, `cpu`）を選択できます。

```bash
cargo run --release -- --backend cuda train
```

### 推論

学習が完了すると`artifacts`ディレクトリにモデルが保存されます。以下のコマンドで、指定した周波数に対する音叉の寸法を予測します。

```bash
# 例: 440Hzの音叉の寸法を予測
cargo run --release -- --backend cuda infer --freq 440.0
```

-----

## 現在の状況と今後の改善策

### 現状

  - **学習の安定性**: コードのバグは解消され、学習プロセスは安定しています。モデルは、設定されたハイパーパラメータ（`ALPHA`、学習率、ペナルティ重み）に基づいて、損失を着実に下げ、一貫した結果を出すことができます。
  - **精度の限界**: 現在の予測精度は、主に\*\*学習データセットのサイズ（100件）\*\*によって制限されています。データが少ないため、モデルは「FEMデータの正解」と「物理法則の近似」という2つの競合する要求を完全には両立できず、最適な解から少しズレた地点に収束しています。

### 今後の改善策

モデルの精度をさらに向上させるための最も効果的なアプローチは、**データセットの拡充**です。

  - **データ数を増やす**: FEMシミュレーションの実行数を500〜1000件程度に増やすことで、モデルは物理法則の近似式に大きく頼らずとも、データから直接、より正確な物理現象を学習できるようになります。
  - **データ密度を上げる**: 特に予測したい重要な周波数帯（例: 440Hz周辺）のデータを重点的に増やすことで、その領域での内挿（補間）精度が大幅に向上します。